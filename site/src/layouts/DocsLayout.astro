---
import BaseLayout from "./BaseLayout.astro";
import { DocsSidebar } from "../components/DocsSidebar";
import { PrevNextNav } from "../components/PrevNextNav";
import { PageHeader } from "../components/PageHeader";

interface Props {
  title: string;
  category: string;
  categoryDisplay: string;
  description?: string;
  activePath: string;
  sections: { category: string; links: { label: string; href: string }[] }[];
  prev?: { label: string; href: string };
  next?: { label: string; href: string };
}

const { title, categoryDisplay, description, activePath, sections, prev, next } = Astro.props;
const basePath = import.meta.env.BASE_URL.replace(/\/$/, "");
---
<BaseLayout title={`${title} â€” stitch-mcp`}>
  <DocsSidebar sections={sections} activePath={activePath} basePath={basePath} client:load />
  <main class="md:ml-[200px] ml-0 transition-[margin] duration-300">
    <div class="max-w-[700px] mx-auto px-6 pt-24 pb-24">
      <PageHeader category={categoryDisplay} title={title}>
        {description}
      </PageHeader>
      <div class="docs-prose">
        <slot />
      </div>
      <PrevNextNav prev={prev} next={next} />
    </div>
  </main>
  <script>
    document.addEventListener("click", (e) => {
      const btn = (e.target as HTMLElement).closest<HTMLButtonElement>("[data-role=tui-copy]");
      if (!btn) return;
      const frame = btn.closest(".tui-frame");
      const code = frame?.querySelector("pre")?.textContent ?? "";
      navigator.clipboard.writeText(code).then(() => {
        btn.textContent = "OK";
        btn.classList.add("copied");
        setTimeout(() => {
          btn.textContent = "COPY";
          btn.classList.remove("copied");
        }, 1500);
      });
    });
  </script>
</BaseLayout>
